workflows:
  ios-workflow:
    name: iOS Build Workflow
    max_build_duration: 60
    environment:
      xcode: latest
      cocoapods: default
      flutter: stable
    cache:
      cache_paths:
        - $HOME/.pub-cache
        - ios/Pods

    scripts:
      # 1ï¸âƒ£ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø§ÙƒØ¬Ø§Øª
      - name: ğŸ”¹ Pre-build setup
        script: |
          flutter clean
          flutter pub get
          flutter precache

      # 2ï¸âƒ£ ØªØ¬Ù‡ÙŠØ² Podfile Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ Ù„Ùˆ Ù†Ø§Ù‚Øµ
      - name: ğŸ”¹ Ensure Podfile exists
        script: |
          cd ios
          if [ ! -f Podfile ]; then
            echo "Podfile not found. Creating a default Podfile..."
            cat <<EOF > Podfile
            platform :ios, '12.0'
            use_frameworks!
            use_modular_headers!

            target 'Runner' do
              flutter_application_path = '../'
              eval(File.read(File.join(flutter_application_path, '.ios', 'Flutter', 'podhelper.rb')), binding)
            end
          EOF
          fi
          cd ..

# 3ï¸âƒ£ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù€ CocoaPods Ø¨Ø¹Ø¯ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø¯ÙŠÙ…
      - name: ğŸ”¹ Install CocoaPods
        script: |
          cd ios
          rm -rf Pods Podfile.lock
          pod install --repo-update
          cd ..

      # 4ï¸âƒ£ Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ iOS (Release Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚ÙŠØ¹ ÙƒÙˆØ¯)
      - name: ğŸ”¹ Build iOS App (no code sign)
        script: |
          flutter build ios --release --no-codesign

    artifacts:
      - build/ios/ipa/*.ipa
      - build/ios/archive/*.xcarchive
      - build/ios/iphoneos/*.app
